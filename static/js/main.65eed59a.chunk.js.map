{"version":3,"sources":["Checkout/CheckoutList.tsx","CartContext/useCart.ts","CartContext/CartContext.tsx","Checkout/FormField.tsx","Checkout/CheckoutForm.tsx","utils/api.ts","Checkout/Checkout.tsx","Home/ProductCard.tsx","Home/useProducts.ts","Home/Home.tsx","Cart/CartItem.tsx","Cart/Cart.tsx","shared/CartWidget/CartWidget.tsx","shared/Header.tsx","shared/Loader.tsx","OrderSummary/useOrder.ts","OrderSummary/OrderSummary.tsx","App.tsx","index.tsx"],"names":["CheckoutList","_ref","products","_jsx","className","children","map","product","name","saveProducts","localStorage","setItem","JSON","stringify","CartContext","createContext","CartProvider","value","useCart","setProducts","useState","useEffect","storedProducts","getItem","parsedProducts","parse","error","totalPrice","reduce","total","Number","price","addToCart","newProduct","find","newProducts","removeFromCart","filter","p","clearCart","Provider","useCartContext","useContext","FormField","label","inputRef","errors","normalize","inputProps","_jsxs","id","concat","htmlFor","ref","onChange","e","target","message","validationSchema","yup","shape","required","matches","payCode","CheckoutForm","submit","async","register","handleSubmit","useForm","mode","onSubmit","placeholder","type","inputMode","supabaseUrl","supabase","createClient","Checkout","orderId","order","data","from","insert","select","console","Error","postCheckout","join","window","location","assign","ProductCard","datum","isInCart","style","imageRendering","src","image","width","height","alt","disabled","onClick","useProducts","categories","setCategories","isLoading","setIsLoading","setError","fetch","Date","getTime","then","res","json","catch","log","fetchProducts","Home","_Fragment","category","items","item","CartItem","Cart","length","Link","to","CartWidget","Header","Loader","useOrder","setOrder","URLSearchParams","search","get","eq","getOrder","orderArray","split","fetchData","OrderSummary","App","Switch","Route","exact","path","ReactDOM","render","StrictMode","BrowserRouter","basename","document","getElementById"],"mappings":"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","file":"static/js/main.65eed59a.chunk.js","sourcesContent":["import { Product } from \"../shared/types\"\n\nexport interface CheckoutListProps {\n  products: Product[]\n}\n\nexport const CheckoutList = ({ products }: CheckoutListProps) => {\n  return (\n    <ul className=\"nes-list is-circle\">\n      {products.map((product) => {\n        return <li key={product.name}>{product.name}</li>\n      })}\n    </ul>\n  )\n}\n","import { useEffect, useState } from \"react\"\nimport { Product } from \"../shared/types\"\n\nconst saveProducts = (products: Product[]) => {\n  localStorage.setItem(\"products\", JSON.stringify(products))\n}\n\nexport const useCart = () => {\n  const [products, setProducts] = useState<Product[]>([])\n\n  useEffect(() => {\n    try {\n      const storedProducts = localStorage.getItem(\n        \"products\"\n      )\n      const parsedProducts = storedProducts\n        ? JSON.parse(storedProducts)\n        : []\n      setProducts(parsedProducts)\n    } catch (error) {}\n  }, [])\n\n  const totalPrice = () => {\n    return products.reduce((total: number, product) => {\n      return total + Number(product.price)\n    }, 0)\n  }\n\n  const addToCart = (newProduct: Product) => {\n    if (\n      products.find(\n        (product) => newProduct.name === product.name\n      )\n    ) {\n      return\n    }\n    const newProducts = [...products, newProduct]\n    setProducts(newProducts)\n    saveProducts(newProducts)\n  }\n\n  const removeFromCart = (product: Product) => {\n    const newProducts = products.filter((p) => {\n      return p.name !== product.name\n    })\n    setProducts(newProducts)\n    saveProducts(newProducts)\n  }\n\n  const clearCart = () => {\n    setProducts([])\n    saveProducts([])\n  }\n\n  return {\n    products,\n    totalPrice,\n    addToCart,\n    removeFromCart,\n    clearCart\n  }\n}\n","import { createContext, useContext } from \"react\"\nimport {useCart} from './useCart'\n\ntype CartContextValue = ReturnType<typeof useCart>\n\nexport const CartContext = createContext({} as CartContextValue)\n\ninterface CartProviderProps {\n  useCartHook?: typeof useCart;\n}\n\nexport const CartProvider = ({ children }: React.PropsWithChildren<CartProviderProps>) => {\n  const value = useCart()\n\n  return (\n    <CartContext.Provider\n      value={value}\n    >\n      {children}\n    </CartContext.Provider>\n  )\n}\n\nexport const useCartContext = () => useContext(CartContext)\n","interface FormError {\n  message: string\n}\n\ninterface FormFieldProps\n  extends React.HTMLProps<HTMLInputElement> {\n  label: string\n  inputRef?: React.Ref<HTMLInputElement>\n  errors?: FormError\n  normalize?: (value: string) => string\n}\n\nexport const FormField = ({\n  label,\n  name,\n  inputRef,\n  errors,\n  normalize = (value) => value,\n  ...inputProps\n}: FormFieldProps) => {\n  return (\n    <div className=\"nes-field\">\n      <label id={`${name}-label`} htmlFor={name}>\n        {label}:\n      </label>\n      <input\n        aria-labelledby={`${name}-label`}\n        ref={inputRef}\n        name={name}\n        {...inputProps}\n        className={`nes-input ${errors && \"is-error\"}`}\n        onChange={(e) =>\n          (e.target.value = normalize(e.target.value))\n        }\n      />\n      {errors && (\n        <p className=\"note nes-text is-error\">\n          错误: {errors.message}\n        </p>\n      )}\n    </div>\n  )\n}\n","import { FormField } from \"./FormField\"\nimport { useForm } from \"react-hook-form\"\nimport * as yup from \"yup\"\n\ninterface CheckoutFormProps {\n  submit?: () => Promise<void>\n}\n\nconst validationSchema = yup.object().shape({\n  name: yup.string().required(\"必填\"),\n  id: yup\n    .string()\n    .required(\"必填\")\n    .matches(\n      /^\\d{8}$/,\n      \"账号ID是8位数字\"\n    ),\n  payCode: yup\n    .string()\n    .required(\"必填\")\n    .matches(/^\\d\\d\\d\\d$/, \"支付密码密码是4位数字\"),\n})\n\nexport const CheckoutForm = ({\n  submit = async () => {},\n}: CheckoutFormProps) => {\n  const { register, errors, handleSubmit } = useForm({\n    mode: \"onBlur\",\n    validationSchema,\n  })\n\n  return (\n    <form data-testid=\"checkout-form\" onSubmit={handleSubmit(submit)}>\n      <FormField\n        placeholder=\"宫本聪\"\n        type=\"text\"\n        name=\"name\"\n        label=\"姓名\"\n        inputRef={register}\n        errors={errors.name}\n      />\n      <FormField\n        placeholder=\"00000000\"\n        type=\"tel\"\n        inputMode=\"numeric\"\n        name=\"id\"\n        label=\"账号ID\"\n        inputRef={register}\n        errors={errors.id}\n      />\n      <FormField\n        placeholder=\"0000\"\n        type=\"tel\"\n        inputMode=\"numeric\"\n        name=\"payCode\"\n        label=\"支付密码\"\n        inputRef={register}\n        errors={errors.payCode}\n      />\n      <button className=\"nes-btn is-primary\">支付</button>\n    </form>\n  )\n}\n","import { createClient } from '@supabase/supabase-js'\n\n\nexport const supabaseUrl = \"https://pznbpgrngldecweoriod.supabase.co\";\nconst supabaseKey =\n    \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6bmJwZ3JuZ2xkZWN3ZW9yaW9kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDkzNDg1ODYsImV4cCI6MjAyNDkyNDU4Nn0.LAHDShsfXdOXlyRlTDy7kvPMxAJdvOhOyuMjii5b_Lw\";\nconst supabase = createClient(supabaseUrl, supabaseKey);\n\nexport const getProducts = () => {\n  return fetch(`${supabaseUrl}/storage/v1/object/public/mario-shop/products.json?${new Date().getTime()}`)\n    .then((res) => {\n      return res.json()\n    })\n    .catch(console.log)\n}\n\nexport const getOrder = async (id: string): Promise<{ order: string }> => {\n  let { data, error } = await supabase\n    .from('orders')\n    .select(\"*\")\n    .eq('id', id)\n\n  if (error) {\n    console.error(error);\n    throw new Error(\"加载失败\");\n  }\n\n  if (!data) return { order: \"\" }\n\n  return data[0]\n}\n\nexport interface CheckoutPayload {\n  order: string\n}\n\nexport const postCheckout = async ({ order }: CheckoutPayload) => {\n  const { data, error } = await supabase\n    .from('orders')\n    .insert([\n      { order },\n    ]).select()\n\n  if (error) {\n    console.error(error);\n    throw new Error(\"加载失败\");\n  }\n\n  if (!data) return {}\n\n  return data[0]\n}\n","import { CheckoutList } from \"./CheckoutList\"\nimport { useCartContext } from \"../CartContext\"\nimport { CheckoutForm } from \"./CheckoutForm\"\nimport { postCheckout } from \"../utils/api\"\n\nexport const Checkout = () => {\n  const { products, totalPrice, clearCart } = useCartContext()\n\n  const submitCheckout = async () => {\n    const { id: orderId } = await postCheckout({\n      order: products.map(product => product.name).join(\",\"),\n    })\n    clearCart()\n    window.location.assign(`/order/?orderId=${orderId}`)\n  }\n\n  return (\n    <section className=\"nes-container with-title\">\n      <h1 className=\"title\">确认订单</h1>\n      <div className=\"nes-container is-rounded checkout-list-wrapper\">\n        <p>您选购的商品:</p>\n        <CheckoutList products={products} />\n        <p>总计: {totalPrice()} Mb</p>\n      </div>\n      <p>选择支付方式:</p>\n      <CheckoutForm submit={submitCheckout} />\n    </section>\n  )\n}\n","import { useCartContext } from \"../CartContext\"\r\nimport { Product } from \"../shared/types\"\r\n\r\nexport interface ProductCardProps {\r\n  datum: Product\r\n}\r\n\r\nexport const ProductCard = ({\r\n  datum,\r\n}: ProductCardProps) => {\r\n  const { addToCart, products } = useCartContext()\r\n\r\n  const isInCart = !!products?.find(\r\n    (product) => datum.name === product.name\r\n  )\r\n\r\n  return (\r\n    <div className=\"nes-container is-rounded item\">\r\n      <img\r\n        style={{ imageRendering: \"pixelated\" }}\r\n        src={`/mario-shop${datum.image}`}\r\n        width=\"64px\"\r\n        height=\"64px\"\r\n        alt=\"goblin\"\r\n      />\r\n      <p>{datum.name}</p>\r\n      <p>{datum.price} Mb</p>\r\n      {isInCart ? (\r\n        <button disabled className=\"nes-btn is-disabled\">\r\n          已添加\r\n        </button>\r\n      ) : (\r\n        <button\r\n          className=\"nes-btn is-primary\"\r\n          onClick={() => {\r\n            addToCart(datum)\r\n          }}\r\n        >\r\n          添加\r\n        </button>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","import { useState, useEffect } from \"react\"\nimport { getProducts } from \"../utils/api\"\nimport { Category } from \"../shared/types\"\n\nexport const useProducts = () => {\n  const [categories, setCategories] = useState<Category[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState(false)\n\n  useEffect(() => {\n    const fetchProducts = async () => {\n      try {\n        const data = await getProducts()\n        setCategories(data.categories || [])\n      } catch (error) {\n        setError(error)\n      }\n      setIsLoading(false)\n    }\n    fetchProducts()\n  }, [])\n\n  return { categories, isLoading, error }\n}\n","import { ProductCard } from \"./ProductCard\"\nimport { useProducts } from \"./useProducts\"\n\nexport const Home = () => {\n  const { categories, isLoading, error } = useProducts()\n\n  if (isLoading) {\n    return <>加载中...</>\n  }\n\n  if (error) {\n    return <>呀！出现了一些错误</>\n  }\n\n  return (\n    <>\n      {categories.map((category) => {\n        return (\n          <section\n            key={category.name}\n            className=\"nes-container with-title showcase\"\n          >\n            <h2 className=\"title\">{category.name}</h2>\n            <section className=\"items\">\n              {category.items.map((item) => {\n                return (\n                  <ProductCard\n                    key={item.name}\n                    datum={item}\n                  />\n                )\n              })}\n            </section>\n          </section>\n        )\n      })}\n    </>\n  )\n}\n","import { Product } from \"../shared/types\"\n\nexport interface CartItemProps {\n  product: Product\n  removeFromCart: (product: Product) => void\n}\n\nexport const CartItem = ({ product, removeFromCart }: CartItemProps) => {\n  return (\n    <div className=\"cart-item\">\n      <img\n        style={{ imageRendering: \"pixelated\" }}\n        src={`/mario-shop${product.image}`}\n        width=\"64px\"\n        height=\"64px\"\n        alt={product.name}\n      />\n      <p>{product.name}</p>\n      <p>{product.price} Mb</p>\n      <button\n        onClick={() => {\n          removeFromCart(product)\n        }}\n        className=\"nes-btn is-error\"\n      >\n        删除\n      </button>\n    </div>\n  )\n}\n","import { Link } from \"react-router-dom\"\nimport { useCartContext } from \"../CartContext\"\nimport { CartItem } from \"./CartItem\"\n\nexport const Cart = () => {\n  const { products, removeFromCart, totalPrice } = useCartContext()\n  if (!products.length) {\n    return (\n      <>\n        商品为空.{\" \"}\n        <Link to=\"/\">回到首页.</Link>\n      </>\n    )\n  }\n\n  return (\n    <section className=\"nes-container with-title is-centered\">\n      <h3 className=\"title\">购物车</h3>\n      <div className=\"cart-items\">\n        {products.map((datum) => (\n          <CartItem\n            key={datum.name}\n            product={datum}\n            removeFromCart={removeFromCart}\n          />\n        ))}\n        <p>总计: {totalPrice()} Mb</p>\n      </div>\n      <div>\n        <Link to=\"/checkout\">\n          <button className=\"nes-btn is-primary\">\n            去结算\n          </button>\n        </Link>\n      </div>\n    </section>\n  )\n}\n","import { Link } from \"react-router-dom\"\nimport { useCartContext } from \"../../CartContext\"\n\nexport const CartWidget = () => {\n  const { products } = useCartContext()\n\n  return (\n    <Link to=\"/cart\" className=\"nes-badge is-icon\">\n      <span className=\"is-error\">{products?.length || 0}</span>\n      <img src={\"/mario-shop/images/cart.svg\"} width=\"64\" height=\"64\" alt=\"cart\" />\n    </Link>\n  )\n}\n","import { Link } from \"react-router-dom\"\nimport { CartWidget } from \"./CartWidget\"\n\nexport const Header = () => (\n  <header>\n    <div className=\"container\">\n      <div className=\"nav-brand\">\n        <Link to=\"/\">\n          <i className=\"pixel-mario brand-logo\"></i>\n        </Link>\n        <div>\n          <h1>马里奥商店</h1>\n          <p>世界第一水管工的奇趣商店</p>\n        </div>\n      </div>\n      <div className=\"cart\">\n        <CartWidget/>\n      </div>\n    </div>\n  </header>\n)\n","export const Loader = () => {\n  return <>加载中...</>\n}\n","import { useState, useEffect } from \"react\"\nimport { getOrder } from \"../utils/api\"\n\nexport interface Order {\n  products: Array<{ name: string }>\n}\n\nconst getOrderId = () => {\n  const urlParams = new URLSearchParams(window.location.search)\n  return urlParams.get(\"orderId\")\n}\n\nexport const useOrder = () => {\n  const [order, setOrder] = useState<Order>()\n  const [isLoading, setIsLoading] = useState(true)\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const orderId = getOrderId()\n      if (!orderId) {\n        return\n      }\n      const { order } = await getOrder(orderId)\n      if (order) {\n        const orderArray = order.split(\",\").map(name => ({ name }))\n        setOrder({\n          products: orderArray\n        })\n      }\n      setIsLoading(false)\n    }\n\n    fetchData()\n  }, [])\n\n  return { order, isLoading }\n}\n","import { Loader } from \"../shared/Loader\"\nimport { Link } from \"react-router-dom\"\nimport { useOrder } from \"./useOrder\"\n\nexport const OrderSummary = () => {\n  const {isLoading, order} = useOrder()\n\n  if (isLoading) {\n    return <Loader />\n  }\n\n  if (!order) {\n    return <div>下单失败！请重试</div>\n  }\n\n  return (\n    <section className=\"nes-container with-title\">\n      <h1 className=\"title\">下单成功！订单详情：</h1>\n      <div className=\"nes-container is-rounded order-summary-container\">\n        <ul className=\"nes-list is-circle\">\n          {order.products.map((product) => {\n            return <li key={product.name}>{product.name}</li>\n          })}\n        </ul>\n      </div>\n      <Link to=\"/\">\n        <button className=\"nes-btn is-primary\">回到首页</button>\n      </Link>\n    </section>\n  )\n}\n","import { Switch, Route } from \"react-router-dom\"\nimport { Checkout } from \"./Checkout\"\nimport { Home } from \"./Home\"\nimport { Cart } from \"./Cart\"\nimport { Header } from \"./shared/Header\"\nimport { OrderSummary } from \"./OrderSummary\"\n\nexport const App = () => {\n  return (\n    <>\n      <Header />\n      <div className=\"container\">\n        <Switch>\n          <Route exact path=\"/\">\n            <Home />\n          </Route>\n          <Route path=\"/checkout\">\n            <Checkout />\n          </Route>\n          <Route path=\"/cart\">\n            <Cart />\n          </Route>\n          <Route path=\"/order\">\n            <OrderSummary />\n          </Route>\n          <Route>404 页面不存在</Route>\n        </Switch>\n      </div>\n    </>\n  )\n}\n","import { StrictMode } from \"react\"\nimport ReactDOM from \"react-dom\"\nimport { BrowserRouter } from \"react-router-dom\"\nimport { App } from \"./App\"\nimport { CartProvider } from \"./CartContext\"\nimport \"./index.css\"\nimport \"./mario.css\"\n\n\nReactDOM.render(\n  <StrictMode>\n    <CartProvider>\n      <BrowserRouter basename={\"/mario-shop\"}>\n        <App />\n      </BrowserRouter>\n    </CartProvider>\n  </StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}