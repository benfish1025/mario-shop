(this["webpackJsonpmario-shop"]=this["webpackJsonpmario-shop"]||[]).push([[0],{41:function(e,t,c){},42:function(e,t,c){},43:function(e,t,c){"use strict";c.r(t);var s=c(0),r=c(24),n=c.n(r),a=c(7),i=c(3),o=c(1);const l=e=>{let{products:t}=e;return Object(o.jsx)("ul",{className:"nes-list is-circle",children:t.map((e=>Object(o.jsx)("li",{children:e.name},e.name)))})},j=e=>{localStorage.setItem("products",JSON.stringify(e))},d=Object(s.createContext)({}),b=e=>{let{children:t}=e;const c=(()=>{const[e,t]=Object(s.useState)([]);return Object(s.useEffect)((()=>{try{const e=localStorage.getItem("products"),c=e?JSON.parse(e):[];t(c)}catch(e){}}),[]),{products:e,totalPrice:()=>e.reduce(((e,t)=>e+Number(t.price)),0),addToCart:c=>{if(e.find((e=>c.name===e.name)))return;const s=[...e,c];t(s),j(s)},removeFromCart:c=>{const s=e.filter((e=>e.name!==c.name));t(s),j(s)},clearCart:()=>{t([]),j([])}}})();return Object(o.jsx)(d.Provider,{value:c,children:t})},m=()=>Object(s.useContext)(d),h=e=>{let{label:t,name:c,inputRef:s,errors:r,normalize:n=(e=>e),...a}=e;return Object(o.jsxs)("div",{className:"nes-field",children:[Object(o.jsxs)("label",{id:"".concat(c,"-label"),htmlFor:c,children:[t,":"]}),Object(o.jsx)("input",{"aria-labelledby":"".concat(c,"-label"),ref:s,name:c,...a,className:"nes-input ".concat(r&&"is-error"),onChange:e=>e.target.value=n(e.target.value)}),r&&Object(o.jsxs)("p",{className:"note nes-text is-error",children:["\u9519\u8bef: ",r.message]})]})};var O=c(25),x=c(15);const u=x.a().shape({name:x.b().required("\u5fc5\u586b"),id:x.b().required("\u5fc5\u586b").matches(/^\d{8}$/,"\u8d26\u53f7ID\u662f8\u4f4d\u6570\u5b57"),payCode:x.b().required("\u5fc5\u586b").matches(/^\d\d\d\d$/,"\u652f\u4ed8\u5bc6\u7801\u5bc6\u7801\u662f4\u4f4d\u6570\u5b57")}),p=e=>{let{submit:t=(async()=>{})}=e;const{register:c,errors:s,handleSubmit:r}=Object(O.a)({mode:"onBlur",validationSchema:u});return Object(o.jsxs)("form",{"data-testid":"checkout-form",onSubmit:r(t),children:[Object(o.jsx)(h,{placeholder:"\u5bab\u672c\u806a",type:"text",name:"name",label:"\u59d3\u540d",inputRef:c,errors:s.name}),Object(o.jsx)(h,{placeholder:"00000000",type:"tel",inputMode:"numeric",name:"id",label:"\u8d26\u53f7ID",inputRef:c,errors:s.id}),Object(o.jsx)(h,{placeholder:"0000",type:"tel",inputMode:"numeric",name:"payCode",label:"\u652f\u4ed8\u5bc6\u7801",inputRef:c,errors:s.payCode}),Object(o.jsx)("button",{className:"nes-btn is-primary",children:"\u652f\u4ed8"})]})};var g=c(30);const N="https://pznbpgrngldecweoriod.supabase.co",v=Object(g.a)(N,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6bmJwZ3JuZ2xkZWN3ZW9yaW9kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDkzNDg1ODYsImV4cCI6MjAyNDkyNDU4Nn0.LAHDShsfXdOXlyRlTDy7kvPMxAJdvOhOyuMjii5b_Lw"),y=()=>{const{products:e,totalPrice:t,clearCart:c}=m();return Object(o.jsxs)("section",{className:"nes-container with-title",children:[Object(o.jsx)("h1",{className:"title",children:"\u786e\u8ba4\u8ba2\u5355"}),Object(o.jsxs)("div",{className:"nes-container is-rounded checkout-list-wrapper",children:[Object(o.jsx)("p",{children:"\u60a8\u9009\u8d2d\u7684\u5546\u54c1:"}),Object(o.jsx)(l,{products:e}),Object(o.jsxs)("p",{children:["\u603b\u8ba1: ",t()," Mb"]})]}),Object(o.jsx)("p",{children:"\u9009\u62e9\u652f\u4ed8\u65b9\u5f0f:"}),Object(o.jsx)(p,{submit:async()=>{const{id:t}=await(async e=>{let{order:t}=e;const{data:c,error:s}=await v.from("orders").insert([{order:t}]).select();if(s)throw console.error(s),new Error("\u52a0\u8f7d\u5931\u8d25");return c?c[0]:{}})({order:e.map((e=>e.name)).join(",")});c(),window.location.assign("/mario-shop/order/?orderId=".concat(t))}})]})},f=e=>{let{datum:t}=e;const{addToCart:c,products:s}=m(),r=!(null===s||void 0===s||!s.find((e=>t.name===e.name)));return Object(o.jsxs)("div",{className:"nes-container is-rounded item",children:[Object(o.jsx)("img",{style:{imageRendering:"pixelated"},src:"/mario-shop".concat(t.image),width:"64px",height:"64px",alt:"goblin"}),Object(o.jsx)("p",{children:t.name}),Object(o.jsxs)("p",{children:[t.price," Mb"]}),r?Object(o.jsx)("button",{disabled:!0,className:"nes-btn is-disabled",children:"\u5df2\u6dfb\u52a0"}):Object(o.jsx)("button",{className:"nes-btn is-primary",onClick:()=>{c(t)},children:"\u6dfb\u52a0"})]})},w=()=>{const[e,t]=Object(s.useState)([]),[c,r]=Object(s.useState)(!0),[n,a]=Object(s.useState)(!1);return Object(s.useEffect)((()=>{(async()=>{try{const e=await fetch("".concat(N,"/storage/v1/object/public/mario-shop/products.json?").concat((new Date).getTime())).then((e=>e.json())).catch(console.log);t(e.categories||[])}catch(n){a(n)}r(!1)})()}),[]),{categories:e,isLoading:c,error:n}},I=()=>{const{categories:e,isLoading:t,error:c}=w();return t?Object(o.jsx)(o.Fragment,{children:"\u52a0\u8f7d\u4e2d..."}):c?Object(o.jsx)(o.Fragment,{children:"\u5440\uff01\u51fa\u73b0\u4e86\u4e00\u4e9b\u9519\u8bef"}):Object(o.jsx)(o.Fragment,{children:e.map((e=>Object(o.jsxs)("section",{className:"nes-container with-title showcase",children:[Object(o.jsx)("h2",{className:"title",children:e.name}),Object(o.jsx)("section",{className:"items",children:e.items.map((e=>Object(o.jsx)(f,{datum:e},e.name)))})]},e.name)))})},C=e=>{let{product:t,removeFromCart:c}=e;return Object(o.jsxs)("div",{className:"cart-item",children:[Object(o.jsx)("img",{style:{imageRendering:"pixelated"},src:"/mario-shop".concat(t.image),width:"64px",height:"64px",alt:t.name}),Object(o.jsx)("p",{children:t.name}),Object(o.jsxs)("p",{children:[t.price," Mb"]}),Object(o.jsx)("button",{onClick:()=>{c(t)},className:"nes-btn is-error",children:"\u5220\u9664"})]})},S=()=>{const{products:e,removeFromCart:t,totalPrice:c}=m();return e.length?Object(o.jsxs)("section",{className:"nes-container with-title is-centered",children:[Object(o.jsx)("h3",{className:"title",children:"\u8d2d\u7269\u8f66"}),Object(o.jsxs)("div",{className:"cart-items",children:[e.map((e=>Object(o.jsx)(C,{product:e,removeFromCart:t},e.name))),Object(o.jsxs)("p",{children:["\u603b\u8ba1: ",c()," Mb"]})]}),Object(o.jsx)("div",{children:Object(o.jsx)(a.b,{to:"/checkout",children:Object(o.jsx)("button",{className:"nes-btn is-primary",children:"\u53bb\u7ed3\u7b97"})})})]}):Object(o.jsxs)(o.Fragment,{children:["\u5546\u54c1\u4e3a\u7a7a."," ",Object(o.jsx)(a.b,{to:"/",children:"\u56de\u5230\u9996\u9875."})]})},k=()=>{const{products:e}=m();return Object(o.jsxs)(a.b,{to:"/cart",className:"nes-badge is-icon",children:[Object(o.jsx)("span",{className:"is-error",children:(null===e||void 0===e?void 0:e.length)||0}),Object(o.jsx)("img",{src:"/mario-shop/images/cart.svg",width:"64",height:"64",alt:"cart"})]})},J=()=>Object(o.jsx)("header",{children:Object(o.jsxs)("div",{className:"container",children:[Object(o.jsxs)("div",{className:"nav-brand",children:[Object(o.jsx)(a.b,{to:"/",children:Object(o.jsx)("i",{className:"pixel-mario brand-logo"})}),Object(o.jsxs)("div",{children:[Object(o.jsx)("h1",{children:"\u9a6c\u91cc\u5965\u5546\u5e97"}),Object(o.jsx)("p",{children:"\u4e16\u754c\u7b2c\u4e00\u6c34\u7ba1\u5de5\u7684\u5947\u8da3\u5546\u5e97"})]})]}),Object(o.jsx)("div",{className:"cart",children:Object(o.jsx)(k,{})})]})}),F=()=>Object(o.jsx)(o.Fragment,{children:"\u52a0\u8f7d\u4e2d..."}),M=()=>{const[e,t]=Object(s.useState)(),[c,r]=Object(s.useState)(!0);return Object(s.useEffect)((()=>{(async()=>{const e=new URLSearchParams(window.location.search).get("orderId");if(!e)return;const{order:c}=await(async e=>{let{data:t,error:c}=await v.from("orders").select("*").eq("id",e);if(c)throw console.error(c),new Error("\u52a0\u8f7d\u5931\u8d25");return t?t[0]:{order:""}})(e);if(c){const e=c.split(",").map((e=>({name:e})));t({products:e})}r(!1)})()}),[]),{order:e,isLoading:c}},D=()=>{const{isLoading:e,order:t}=M();return e?Object(o.jsx)(F,{}):t?Object(o.jsxs)("section",{className:"nes-container with-title",children:[Object(o.jsx)("h1",{className:"title",children:"\u4e0b\u5355\u6210\u529f\uff01\u8ba2\u5355\u8be6\u60c5\uff1a"}),Object(o.jsx)("div",{className:"nes-container is-rounded order-summary-container",children:Object(o.jsx)("ul",{className:"nes-list is-circle",children:t.products.map((e=>Object(o.jsx)("li",{children:e.name},e.name)))})}),Object(o.jsx)(a.b,{to:"/",children:Object(o.jsx)("button",{className:"nes-btn is-primary",children:"\u56de\u5230\u9996\u9875"})})]}):Object(o.jsx)("div",{children:"\u4e0b\u5355\u5931\u8d25\uff01\u8bf7\u91cd\u8bd5"})},R=()=>Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(J,{}),Object(o.jsx)("div",{className:"container",children:Object(o.jsxs)(i.c,{children:[Object(o.jsx)(i.a,{exact:!0,path:"/",children:Object(o.jsx)(I,{})}),Object(o.jsx)(i.a,{path:"/checkout",children:Object(o.jsx)(y,{})}),Object(o.jsx)(i.a,{path:"/cart",children:Object(o.jsx)(S,{})}),Object(o.jsx)(i.a,{path:"/order",children:Object(o.jsx)(D,{})}),Object(o.jsx)(i.a,{children:"404 \u9875\u9762\u4e0d\u5b58\u5728"})]})})]});c(41),c(42);n.a.render(Object(o.jsx)(s.StrictMode,{children:Object(o.jsx)(b,{children:Object(o.jsx)(a.a,{basename:"/mario-shop",children:Object(o.jsx)(R,{})})})}),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.7ef608e0.chunk.js.map